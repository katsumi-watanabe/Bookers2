<div class="container px-5 px-sm-0">
  <div class="row">

<div class="col-md-3" >
      <h2>User info</h2>
      <%= attachment_image_tag @user, :profile_image, :fill, 100, 100, format: 'jpeg',fallback: "no_image.jpg" %>
  <table class="table">
  <tbody><tr></tr>
  <tr>
	  <th>name</th>
	  <th><%= @user.name %></th>
  </tr>
  <tr>
	  <th>introduction</th>
	  <th><%= @user.introduction %></th>
  </tr>
  <tr>
	  <th>follows</th>
	  <th><%= link_to @user.followings.count, user_followings_path(@user) %></th>
  </tr>
  <tr>
	  <th>followers</th>
	  <th><%= link_to @user.followers.count, user_followers_path(@user) %></th>
  </tr>
</tbody>
</table>


<div class="row">
  <% if current_user.id == @user.id %>
  <%= link_to"", edit_user_path(current_user), class: "btn btn-outline-secondary btn-block fas fa-user-cog" %>
  <% else %>
  <% if current_user.following?(@user) %>
    <%= link_to "Unfollow", user_relationships_path(@user.id), class: "btn btn-info ml-3", method: :delete %>
  <% else %>
    <%= link_to "Follow", user_relationships_path(@user.id), class: "btn btn-success ml-3", method: :post %>
  <% end %>
  <% end %>
</div>

  <h2 class="mt-3">New book</h2>

  <%= form_with model: @book, local:true do |f| %>
  <div class="form-group">
    <label for="book_title">Title</label>
     <%= f.text_field :title,class: "form-control book_title" %>
  </div>
  <div class="form-group">
    <label for="book_opinion">Opinion</label>
    <%= f.text_area :body, class: "form-control book_body" %>
  </div>
  <div class="form-group">
    <label for="book_opinion">Category</label>
     <%= f.text_field :category,class: "form-control book_category", value: @category %>
  </div>
  <div class="mb-3" id="star">
    <%= f.label :evaluation, "Rate" %>
    <%= f.hidden_field :evaluation, id: :review_star %>

    <script>
    $('#star<%= @book.id %>').empty();
    $('#star').raty({
      size     : 36,
      starOff:  '<%= asset_path('star-off.png') %>',
      starOn : '<%= asset_path('star-on.png') %>',
      starHalf: '<%= asset_path('star-half.png') %>',
      scoreName: 'book[evaluation]',
      half: true,
    });
    </script>
  </div>
  <div class="form-group">
    <%= f.submit 'Create Book', class: "btn btn-success" %>
  </div>
    <% end %>
    </div>

 <div class="col-md-8 offset-md-1">
  <h2>Books</h2>
  <table class="table table-hover table-inverse">
  <thead>
    <tr>
      <th></th>
      <th>Title</th>
      <th>Opinion</th>
      <th>Category</th>
    </tr>
  </thead>
  <tbody>
    <% @user.books.each do |book| %>
      <tr>
        <%= link_to user_path(@user) do %>
        <td>
          <%= attachment_image_tag @user, :profile_image, size: "40x40", format: 'jpeg',fallback: "no_image.jpg" %>
          </td>
        <% end %>
        <td><%= link_to book.title, book_path(book.id) %></td>
        <td><%= book.body %></td>
        <td><%= book.category %></td>
      </tr>
    <% end %>
  </tbody>
  </table>

  <div>
    <h3>投稿数の前日比・前週比</h3>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>今日の投稿数</th>
          <th>前日の投稿数</th>
          <th>前日比</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <% @user_today = @user.books.where(created_at: Time.zone.now.all_day).count %>
            <%= @user.books.where(created_at: Time.zone.now.all_day).count %>
          </td>
          <td>
            <% @user_yesterday = @user.books.where(created_at: 1.day.ago.all_day).count %>
            <%= @user.books.where(created_at: 1.day.ago.all_day).count %>
            </td>
          <td>
            <% if @user_yesterday == 0 %>
              投稿が0のため計算できません
            <% else %>
              <% @user_book_day = @user_today / @user_yesterday %>
              <%= (@user_book_day.to_d * 100).round %>%
            <% end %>
          </td>

        </tr>
      </tbody>
    </table>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>今週の投稿数</th>
          <th>前週の投稿数</th>
          <th>前週比</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <% @user_week = @user.books.where(created_at: Time.zone.now.all_week).count %>
            <%= @user.books.where(created_at: Time.zone.now.all_week).count %>
            </td>
          <td>
            <% @user_last_week = @user.books.where(created_at: 1.day.ago.all_week).count %>
            <%= @user.books.where(created_at: 1.day.ago.all_week).count %>
            </td>
          <td>
            <% if @user_last_week == 0 %>
              投稿が0のため計算できません
            <% else %>
              <% @user_book_week = @user_week / @user_last_week %>
              <%= (@user_book_week.to_d * 100).round %>%
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  </div>
  </div>
</div>