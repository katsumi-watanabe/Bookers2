<main>
    <div class="container px-5 px-sm-0">

  <div class="row">

<div class="col-md-3">
      <h2>User info</h2>
      <%= attachment_image_tag @user, :profile_image, :fill, 100, 100, format: 'jpeg',fallback: "no_image.jpg" %>
  <table class="table">
  <tbody><tr></tr>
  <tr>
	  <th>name</th>
	  <th><%= @user.name %></th>
  </tr>
  <tr>
	  <th>introduction</th>
	  <th><%= @user.introduction %></th>
  </tr>
</tbody>
</table>


<div class="row">
  <%= link_to"", edit_user_path(@user), class: "btn btn-outline-secondary btn-block fas fa-user-cog" %>
</div>

  <h2 class="mt-3">New book</h2>

  <%= form_with model: @book_new, local:true do |f| %>
  <div class="form-group">
    <label for="book_title">Title</label>
     <%= f.text_field :title,class: "form-control book_title" %>
  </div>
  <div class="form-group">
    <label for="book_opinion">Opinion</label>
    <%= f.text_area :body, class: "form-control book_body" %>
  </div>
  <div class="form-group">
    <%= f.submit 'Create Book', class: "btn btn-success" %>
  </div>
    <% end %>
    </div>

 <div class="col-md-8 offset-md-1">
  		<h2>Book detail</h2>
  		<table class="table">
  		  <tbody>
  		    <tr>
          <td>
            <%= link_to user_path(@user) do %>
              <%= attachment_image_tag @user, :profile_image, size: "50x50", format: 'jpeg',fallback: "no_image.jpg" %><br>
            <%= @user.name %>
            <% end %>
          </td>
          <td><%= link_to @book.title, book_path %></td>
          <td><%= @book.body %></td>
          <% if @book.user == current_user %>
          <td><%= link_to"Edit", edit_book_path(@book.id), class: "btn btn-sm btn-success" %></td>
          <td><%= link_to"Destroy", book_path(@book.id), method: :delete  , class: "btn btn-sm btn-danger", data: {confirm: "本当に消しますか？"} %></td>
          <% end %>

          <% if @book.favorited_by?(current_user) %>
          <td>
            <%= link_to book_favorites_path(@book), class: "text-danger" ,method: :delete do %>
              ♥<%= @book.favorites.count %>
            <% end %>
          </td>
          <td>
            コメント数：<%= @book.post_comments.count %>
          </td>
          <% else %>
          <td>
            <%= link_to book_favorites_path(@book), method: :post do %>
              ♥<%= @book.favorites.count %>
            <% end %>
          </td>
          <td>
            コメント数：<%= @book.post_comments.count %>
          </td>
        <% end %>
        </tr>
      </tbody>
      </table>

      <div class="flex-column">

        <% @book.post_comments.each do |post_comment|%>
        <div class="form-inline" >
          <p><%= attachment_image_tag @user, :profile_image, size: "50x50", format: 'jpeg',fallback: "no_image.jpg" %><br>
          <%= link_to @user.name, user_path(@user)%></p>
          <%= post_comment.comment %>
          <% if post_comment.user ==  current_user %>
          <div class="comment-delete">
          <%= link_to "Destroy",book_post_comment_path(post_comment.book, post_comment), class: "btn btn-sm btn-danger",method: :delete %>
          </div>
          <% end %>
        </div>
        <% end %>

      </div>
      <div class="new-comment">
        <%= form_with(model:[@book, @post_comment], local: true) do |f| %>
          <%= f.text_area :comment, rows:'5', class: "form-control" %></br>
          <%= f.submit "送信" %>
        <% end %>
        </div>
    </div>

  </div>
</div>
</main>